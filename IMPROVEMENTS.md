# Secretary 仓库改进清单

本文档梳理可行的改进方式，便于后续按优先级落实。优先级为：**P0 高 / P1 中 / P2 低**。

---

## 一、文档与易用性

| 项 | 说明 | 优先级 |
|----|------|--------|
| README | 已补充项目说明、快速开始、目录结构、命令、环境变量、流程简述。 | ✅ 已完成 |
| 示例任务 | 在 `tasks/` 或 `docs/` 下提供 1～2 个示例任务文件，方便新用户模仿。 | P1 |
| 故障排查 | 在 README 或 `docs/TROUBLESHOOTING.md` 中写常见问题（如 cursor 找不到、任务一直不完成等）。 | P1 |
| 配置示例 | 提供 `config.example.py` 或 `.env.example` 列出所有可配置项及示例值。 | P2 |

---

## 二、功能

| 项 | 说明 | 优先级 |
|----|------|--------|
| 任务取消 | 支持将 `ongoing/` 中某任务移回 `tasks/` 或标记为取消，避免误删文件。 | P1 |
| 任务优先级 | 任务文件或文件名支持优先级/标签，扫描器按优先级或标签顺序处理。 | P2 |
| 单任务执行 | 支持只执行指定任务文件（如 `python main.py run tasks/xxx.md`），不经过扫描器。 | P1 |
| 报告命名 | 报告文件名与任务名对应关系在 README 中写清；或统一为 `{task_stem}-report.md` 并在 Worker 提示中强调。 | P0（文档已可覆盖） |
| Worker 工作区解析 | `worker.py` 中从任务文件解析「工作区」路径的逻辑较脆弱（依赖启发式），可改为在任务模板中固定 `## 工作区` 下一行即路径，并做解析。 | P1 |

---

## 三、流程与可靠性

| 项 | 说明 | 优先级 |
|----|------|--------|
| 扫描器单任务模式 | 当前 `scan` 会在一轮内处理完所有 `ongoing/` 再处理 `tasks/`。可选项：一次只取一个任务，处理完再取下一个。 | P2 |
| 超时与重试 | `agent_runner.run_agent` 支持 `timeout`，但 Scanner/Worker 未传；可对单次 Worker 调用设超时，超时后重试或标记失败。 | P1 |
| 失败标记 | Worker 明确失败（如多次报错）时，可将任务移入 `failed/` 或追加失败标记，并写简短报告，避免无限重试。 | P1 |
| 幂等与并发 | 若未来支持多进程/多机扫描，需考虑 `tasks/` → `ongoing/` 移动的原子性（如用文件锁或唯一命名）。 | P2 |

---

## 四、工具链与开发体验

| 项 | 说明 | 优先级 |
|----|------|--------|
| 依赖与环境 | 当前仅用标准库；若引入第三方库，建议增加 `requirements.txt` 和可选 `pyproject.toml`。 | P2 |
| 测试 | 为 `config`、路径解析、秘书/Worker 的 prompt 构建等增加单元测试，便于重构。 | P1 |
| 日志 | 用 `logging` 替代部分 `print`，支持日志级别与输出到文件，便于排查。 | P2 |
| 类型与规范 | 保持 3.10+ 类型注解；可加 `ruff`/`mypy` 做风格与类型检查。 | P2 |

---

## 五、与 Cursor 的集成

| 项 | 说明 | 优先级 |
|----|------|--------|
| Cursor 未安装 | 启动时检测 `cursor` 是否可用，不可用时给出明确提示与安装/配置说明。 | P1 |
| 规则与提示 | 定期回顾 `.cursor/rules/secretary-agent.md` 与各 Agent 的 prompt，确保与最新行为一致。 | P1 |
| 多工作区 | 若需同时为多个项目目录执行任务，可支持「工作区池」或每个任务绑定工作区，并在 Worker 中传入。 | P2 |

---

## 六、后续可扩展方向

- **Web/API**：提供简单 HTTP 或 Web 界面提交任务、查看状态与报告。
- **通知**：任务完成或失败时发送通知（邮件、Webhook、桌面通知等）。
- **统计**：统计任务数量、完成率、平均耗时等，输出简单报表。

以上项未标优先级，可按需求再排期。

---

落实时建议：先做 P0/P1 中与当前痛点最相关的几项，再逐步推进 P2 与扩展方向。
